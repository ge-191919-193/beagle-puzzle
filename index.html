
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>çŒœçŒœæˆ‘æ˜¯èª°ï¼Ÿå¤šé—œå¡æ‹¼åœ–</title>
  <style>
    body { font-family: Arial; background: #fffbe6; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
    h1 { margin: 20px; }
    #game, #cover, #congrats { display: none; flex-direction: column; align-items: center; }
    .show { display: flex !important; }
    #puzzle { display: grid; gap: 2px; margin: 20px; }
    .tile { width: 100px; height: 100px; background-size: 300px 300px; border: 1px solid #ccc; cursor: grab; }
    button { padding: 10px 20px; font-size: 16px; background: #fcae60; color: white; border: none; border-radius: 8px; margin: 5px; cursor: pointer; }
    #moves { font-size: 14px; color: #555; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>çŒœçŒœæˆ‘æ˜¯èª°ï¼ŸğŸ¾</h1>
  <div id="cover" class="show">
    <p>æ¯ä¸€é—œéƒ½æœ‰ä¸åŒçš„å‹•ç‰©ï¼ŒæŒ‘æˆ°çœ‹çœ‹ä½ èƒ½èªå‡ºå¹¾å€‹ï¼</p>
    <button onclick="startGame()">é–‹å§‹æŒ‘æˆ° â–¶ï¸</button>
  </div>
  <div id="game">
    <div id="moves">æ»‘å‹•æ¬¡æ•¸ï¼š0</div>
    <div id="buttons">
      <button onclick="shuffleTiles()">é‡æ–°æ‰“äº‚ ğŸ”„</button>
    </div>
    <div id="puzzle"></div>
  </div>
  <div id="congrats">
    <img id="animalImg" src="" width="300" />
    <h2 id="messageText">ä½ å®Œæˆäº†ï½ğŸ‰</h2>
    <button onclick="nextLevel()">ä¸‹ä¸€é—œ â–¶ï¸</button>
  </div>

  <script>
    const levels = [
      { image: "beagle.png", rows: 3, columns: 3, message: "æ±ªæ±ªï½å¥½å²å®³ï¼Œçµ¦ä½ ä¸€æ ¹éª¨é ­çå‹µï¼" },
      { image: "mouse.png", rows: 4, columns: 4, message: "å±å±ï¼ä½ ä¹Ÿå¤ªæœƒæ‰¾æˆ‘äº†å§ï½" }
    ];
    let currentLevel = 0;
    let moves = 0;
    let positions = [];
    let emptyIndex = 0;

    const puzzle = document.getElementById("puzzle");
    const cover = document.getElementById("cover");
    const game = document.getElementById("game");
    const congrats = document.getElementById("congrats");
    const animalImg = document.getElementById("animalImg");
    const messageText = document.getElementById("messageText");
    const movesDisplay = document.getElementById("moves");

    function startGame() {
      cover.classList.remove("show");
      game.classList.add("show");
      initLevel(currentLevel);
    }

    function initLevel(levelIndex) {
      const { rows, columns } = levels[levelIndex];
      puzzle.style.gridTemplateColumns = `repeat(${columns}, 100px)`;
      puzzle.style.gridTemplateRows = `repeat(${rows}, 100px)`;
      const total = rows * columns;
      positions = [...Array(total).keys()];
      shuffle(positions);
      emptyIndex = positions.indexOf(total - 1);
      moves = 0;
      updateMoves();
      render();
    }

    function shuffle(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function shuffleTiles() {
      shuffle(positions);
      emptyIndex = positions.indexOf(positions.length - 1);
      moves = 0;
      updateMoves();
      render();
    }

    function updateMoves() {
      movesDisplay.textContent = "æ»‘å‹•æ¬¡æ•¸ï¼š" + moves;
    }

    function render() {
      puzzle.innerHTML = "";
      const { image, columns } = levels[currentLevel];
      const total = positions.length;
      positions.forEach((pos, i) => {
        if (pos === total - 1) {
          const blank = document.createElement("div");
          blank.className = "tile";
          blank.style.visibility = "hidden";
          puzzle.appendChild(blank);
        } else {
          const tile = document.createElement("div");
          tile.className = "tile";
          const x = pos % columns;
          const y = Math.floor(pos / columns);
          tile.style.backgroundImage = `url('${image}')`;
          tile.style.backgroundPosition = `-${x * 100}px -${y * 100}px`;
          tile.onclick = () => move(i);
          puzzle.appendChild(tile);
        }
      });
    }

    function move(i) {
      const { columns } = levels[currentLevel];
      const valid = [emptyIndex - 1, emptyIndex + 1, emptyIndex - columns, emptyIndex + columns];
      if (valid.includes(i)) {
        [positions[i], positions[emptyIndex]] = [positions[emptyIndex], positions[i]];
        emptyIndex = i;
        moves++;
        updateMoves();
        render();
        checkWin();
      }
    }

    function checkWin() {
      if (positions.every((v, i) => v === i)) {
        game.classList.remove("show");
        congrats.classList.add("show");
        animalImg.src = levels[currentLevel].image;
        messageText.textContent = levels[currentLevel].message;
      }
    }

    function nextLevel() {
      currentLevel++;
      if (currentLevel >= levels.length) {
        alert("å·²å®Œæˆå…¨éƒ¨é—œå¡ï¼ğŸ‰");
        location.reload();
        return;
      }
      congrats.classList.remove("show");
      game.classList.add("show");
      initLevel(currentLevel);
    }
  </script>
</body>
</html>
