
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>😉 拼圖動物宇宙</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fffbe9;
      text-align: center;
      padding: 2em;
    }
    #container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .grid {
      display: grid;
      gap: 2px;
      margin-top: 20px;
      justify-content: center;
    }
    .tile {
      width: 75px;
      height: 75px;
      background-size: 300px 300px;
      font-size: 24px;
      font-weight: bold;
      color: #fff;
    }
    button {
      margin: 10px;
      padding: 8px 16px;
      font-size: 16px;
      background: #f7a84c;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    #congrats {
      display: none;
      font-size: 20px;
      margin-top: 20px;
      position: relative;
    }
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: #f7a84c;
      animation: fall 2s linear infinite;
    }
    @keyframes fall {
      0% { transform: translateY(-100px) rotate(0deg); }
      100% { transform: translateY(600px) rotate(360deg); }
    }
  </style>
</head>
<body>
  <div id="container">
    <h1>😉</h1>
    <p>歡迎來到拼圖動物宇宙，每關完成後會有小驚喜喔！</p>
    <button onclick="startGame()">開始挑戰 ▶️</button>
    <div id="level-status"></div>
    <div id="puzzle" class="grid"></div>
    <div id="congrats">🎉 你完成了所有關卡！</div>
    <button id="reset" onclick="shuffleTiles()" style="display:none;">🔄 重新挑戰本關</button>
  </div>

  <script>
    const levels = [
      { image: 'beagle.png', rows: 3, columns: 3, message: '我是聰明的米格魯！汪汪！' },
      { image: 'rabbit.png', rows: 4, columns: 4, message: '你找到我啦，小兔兔也來撒花囉～！' }
    ];
    let currentLevel = 0;
    let tiles = [], emptyIndex = 0;

    function startGame() {
      document.querySelector("button").style.display = "none";
      document.getElementById("reset").style.display = "inline-block";
      loadLevel();
    }

    function loadLevel() {
      const level = levels[currentLevel];
      const puzzle = document.getElementById("puzzle");
      document.getElementById("congrats").style.display = "none";
      puzzle.style.gridTemplateColumns = `repeat(${level.columns}, 75px)`;
      puzzle.style.gridTemplateRows = `repeat(${level.rows}, 75px)`;
      document.getElementById("level-status").innerText = `第 ${currentLevel + 1} 關 / 共 ${levels.length} 關`;

      tiles = [];
      for (let i = 0; i < level.rows * level.columns; i++) tiles.push(i);
      emptyIndex = tiles.length - 1;
      shuffleArray(tiles);
      renderTiles();
    }

    function shuffleTiles() {
      shuffleArray(tiles);
      renderTiles();
    }

    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
    }

    function renderTiles() {
      const puzzle = document.getElementById("puzzle");
      const level = levels[currentLevel];
      puzzle.innerHTML = "";
      emptyIndex = tiles.indexOf(level.rows * level.columns - 1);

      tiles.forEach((num, i) => {
        const div = document.createElement("div");
        div.className = "tile";
        if (num < level.rows * level.columns - 1) {
          div.style.backgroundImage = `url(${level.image})`;
          const col = level.columns;
          div.style.backgroundPosition = `${-(num % col) * 75}px ${-Math.floor(num / col) * 75}px`;
          div.onclick = () => tryMove(i);
        } else {
          div.style.background = "#eee";
        }
        puzzle.appendChild(div);
      });
    }

    function tryMove(i) {
      const level = levels[currentLevel];
      const col = level.columns;
      const validMoves = [emptyIndex - 1, emptyIndex + 1, emptyIndex - col, emptyIndex + col];
      if (validMoves.includes(i)) {
        [tiles[i], tiles[emptyIndex]] = [tiles[emptyIndex], tiles[i]];
        renderTiles();
        if (isCompleted()) showCompletion();
      }
    }

    function isCompleted() {
      return tiles.every((val, i) => val === i);
    }

    function showCompletion() {
      const puzzle = document.getElementById("puzzle");
      const level = levels[currentLevel];
      puzzle.innerHTML = "";
      for (let i = 0; i < level.rows * level.columns; i++) {
        const div = document.createElement("div");
        div.className = "tile";
        div.style.backgroundImage = `url(${level.image})`;
        div.style.backgroundPosition = `${-(i % level.columns) * 75}px ${-Math.floor(i / level.columns) * 75}px`;
        puzzle.appendChild(div);
      }

      setTimeout(() => {
        currentLevel++;
        if (currentLevel < levels.length) {
          loadLevel();
        } else {
          document.getElementById("congrats").style.display = "block";
          generateConfetti();
        }
      }, 1500);
    }

    function generateConfetti() {
      for (let i = 0; i < 30; i++) {
        const confetti = document.createElement("div");
        confetti.className = "confetti";
        confetti.style.left = Math.random() * 100 + "%";
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 70%)`;
        confetti.style.animationDelay = `${Math.random()}s`;
        confetti.style.top = "-20px";
        document.getElementById("congrats").appendChild(confetti);
      }
    }

    document.addEventListener("keydown", e => {
      if (e.key.toUpperCase() === "T") showCompletion();
    });
  </script>
</body>
</html>
